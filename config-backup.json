{
  "es": {
    "dev": {
      "host": "clclcdcdvm001",
      "port": "9200",
      "index": "cdc"
    },
    "staging": {
      "host": "clclcdcdvm001",
      "port": "9200",
      "index": "cdc"
    },
    "prod": {
      "host": "clclcdcpvm001",
      "port": "9200",
      "index": "cdc"
    }
  },
  "sleep_ms": 5000,
  "connection": {
    "rnumber": {
      "dev": {
        "host": "clcwcdcdap001",
        "database": "ResearchNavigator",
        "user": "hackclick",
        "pass": "12345678",
        "meta": { "foo": 123 }
      },
      "staging": {
        "host": "clcwcdcpap008",
        "database": "ResearchNavigator",
        "user": "hackclick",
        "pass": "12345678"
      },
      "prod": {
        "host": "SQLP91003\\DB03",
        "database": "ResearchNavigator",
        "user": "hackclick",
        "pass": "12345678"
      }
    },
    "crms": {
      "dev": {
        "host": "SQLP91002\\DB02",
        "database": "CRMS",
        "user": "hackclick",
        "pass": "12345678"
      },
      "staging": {
        "host": "clcwcdcpap008",
        "database": "CRMS",
        "user": "hackclick",
        "pass": "12345678"
      },
      "prod": {
        "host": "SQLP91002\\DB02",
        "database": "CRMS",
        "user": "hackclick",
        "pass": "12345678"
      }
    },
    "iacuc": {
      "dev": {
        "host": "clcwcdcdap001",
        "database": "IACUC",
        "user": "hackclick",
        "pass": "12345678"
      },
      "staging": {
        "host": "clcwcdcdap001",
        "database": "[IACUC.QA]",
        "user": "hackclick",
        "pass": "12345678"
      },
      "prod": {
        "host": "SQLP91003\\DB03",
        "database": "IACUC",
        "user": "hackclick",
        "pass": "12345678"
      }
    },
    "dlar": {
      "dev": {
        "host": "clcwcdcdap001",
        "database": "DLAR",
        "user": "hackclick",
        "pass": "12345678"
      },
      "staging": {
        "host": "clcwcdcdap001",
        "database": "[DLAR.QA]",
        "user": "hackclick",
        "pass": "12345678"
      },
      "prod": {
        "host": "SQLP91003\\DB03",
        "database": "DCM",
        "user": "hackclick",
        "pass": "12345678"
      }
    },
    "animalcensus": {
      "dev": {
        "host": "clcwcdcpap008",
        "database": "AnimalCensus",
        "user": "hackclick",
        "pass": "12345678"
      },
      "staging": {
        "host": "clcwcdcpap008",
        "database": "AnimalCensus",
        "user": "hackclick",
        "pass": "12345678"
      },
      "prod": {
        "host": "SQLP91003\\DB03",
        "database": "AnimalCensus",
        "user": "hackclick",
        "pass": "12345678"
      }
    }
  },
  "channels": {
    "iacuc": [
      {
        "name": "iacucsubmission:orginal:status",
        "modelName": "_ClickIACUCSubmission",
        "targetStores": ["dlar"],
        "script": [
          "DECLARE @begin_time datetime, @end_time datetime, @from_lsn binary(10), @to_lsn binary(10);\n",
          "-- Obtain the beginning of the time interval.\n",
          "-- SET @begin_time = GETDATE() -1;\n",
          "SET @begin_time = dateadd(ss, 1, $(LAST_EXEC_TIME) );\n",
          "-- Obtain the end of the time interval.\n",
          "SET @end_time = GETDATE();\n",
          "-- Map the time interval to a change data capture query range.\n",
          "SET @from_lsn = sys.fn_cdc_map_time_to_lsn('smallest greater than or equal', @begin_time);\n",
          "SET @to_lsn = sys.fn_cdc_map_time_to_lsn('largest less than or equal', @end_time);\n",
          "-- Return the net changes occurring within the query window.\n",
          "select _uid, start_time, oid, status from (\n",
          "select y._uid, left(convert(varchar(24), y.start_time, 126), 19) start_time, y.oid, y.status from ( select max(sys.fn_cdc_map_lsn_to_time ( __$start_lsn )) max_start_time, b._uid FROM cdc.fn_cdc_get_all_changes_dbo__Project(@from_lsn, @to_lsn, 'all') a inner join [__ClickIACUCSubmission] b on a.oid = b.oid group by b._uid ) z \n",
          "inner join\n",
          "( select sys.fn_cdc_map_lsn_to_time ( __$start_lsn ) start_time, a.__$start_lsn, a.__$seqval, a.__$operation, a.__$update_mask, convert(varchar(max), a.oid, 2) oid, convert(varchar(max), a.status, 2) status, b._uid FROM cdc.fn_cdc_get_all_changes_dbo__Project(@from_lsn, @to_lsn, 'all') a inner join [__ClickIACUCSubmission] b on a.oid = b.oid where a.status is not null) y \n",
          "on z._uid = y._uid and z.max_start_time = y.start_time\n",
          ") x\n",
          "group by _uid, start_time, oid, status\n", 
          "order by x.start_time;"
          ]
      },
      {
        "name": "iacucsubmission:amendment:status",
        "modelName": "_ClickIACUCSubmission",
        "targetStores": ["dlar"],
        "script": [
          "DECLARE @begin_time datetime, @end_time datetime, @from_lsn binary(10), @to_lsn binary(10);\n",
          "-- Obtain the beginning of the time interval.\n",
          "-- SET @begin_time = GETDATE() -1;\n",
          "SET @begin_time = dateadd(ss, 1, $(LAST_EXEC_TIME) );\n",
          "-- Obtain the end of the time interval.\n",
          "SET @end_time = GETDATE();\n",
          "-- Map the time interval to a change data capture query range.\n",
          "SET @from_lsn = sys.fn_cdc_map_time_to_lsn('smallest greater than or equal', @begin_time);\n",
          "SET @to_lsn = sys.fn_cdc_map_time_to_lsn('largest less than or equal', @end_time);\n",
          "-- Return the net changes occurring within the query window.\n",
          "select _uid, start_time, oid, status from (\n",
          "select y._uid, left(convert(varchar(24), y.start_time, 126), 19) start_time, y.oid, y.status from ( select max(sys.fn_cdc_map_lsn_to_time ( __$start_lsn )) max_start_time, b._uid FROM cdc.fn_cdc_get_all_changes_dbo__Project(@from_lsn, @to_lsn, 'all') a inner join [_Project] p on p.oid = a.oid inner join [__ClickIACUCSubmission] b on p.parentProject = b.oid group by b._uid ) z \n",
          "inner join\n",
          "( select sys.fn_cdc_map_lsn_to_time ( __$start_lsn ) start_time, a.__$start_lsn, a.__$seqval, a.__$operation, a.__$update_mask, convert(varchar(max), a.oid, 2) oid, convert(varchar(max), a.status, 2) status, b._uid FROM cdc.fn_cdc_get_all_changes_dbo__Project(@from_lsn, @to_lsn, 'all') a inner join [_Project] p on p.oid = a.oid inner join [__ClickIACUCSubmission] b on p.parentProject = b.oid inner join _ProjectStatus ps on ps.oid = p.status inner join _Classification c on c.oid = ps.oid where a.status is not null and c.ID = 'Approved') y \n",
          "on z._uid = y._uid and z.max_start_time = y.start_time\n",
          ") x\n",
          "group by _uid, start_time, oid, status\n", 
          "order by x.start_time;"
          ]
      }   
    ],
    "rnumber": [
      {
        "name": "researchproject:animal:status",
        "modelName": "_Research Project",
        "targetStores": ["iacuc"], 
        "script": [
          "DECLARE @begin_time datetime, @end_time datetime, @from_lsn binary(10), @to_lsn binary(10);\n",
          "-- Obtain the beginning of the time interval.\n",
          "-- SET @begin_time = GETDATE() -1;\n",
          "SET @begin_time = dateadd(ss, 1, $(LAST_EXEC_TIME) );\n",
          "-- Obtain the end of the time interval.\n",
          "SET @end_time = GETDATE();\n",
          "-- Map the time interval to a change data capture query range.\n",
          "SET @from_lsn = sys.fn_cdc_map_time_to_lsn('smallest greater than or equal', @begin_time);\n",
          "SET @to_lsn = sys.fn_cdc_map_time_to_lsn('largest less than or equal', @end_time);\n",
          "-- Return the net changes occurring within the query window.\n",
          "select _uid, start_time, oid, status from (\n",
          "select y._uid, left(convert(varchar(24), y.start_time, 126), 19) start_time, y.oid, y.status from ( select max(sys.fn_cdc_map_lsn_to_time ( __$start_lsn )) max_start_time, b._uid FROM cdc.fn_cdc_get_all_changes_dbo__Project(@from_lsn, @to_lsn, 'all') a inner join [__Research Project] b on a.oid = b.oid group by b._uid ) z \n",
          "inner join\n",
          "( select sys.fn_cdc_map_lsn_to_time ( __$start_lsn ) start_time, a.__$start_lsn, a.__$seqval, a.__$operation, a.__$update_mask, convert(varchar(max), a.oid, 2) oid, convert(varchar(max), a.status, 2) status, b._uid FROM cdc.fn_cdc_get_all_changes_dbo__Project(@from_lsn, @to_lsn, 'all') a inner join [__Research Project] b on a.oid = b.oid inner join [__Research Project_CustomAttributesManager] rpc on rpc.oid = b.customAttributes inner join [__StudyDetails] sd on sd.oid = rpc.studyDetails inner join [__StudyDetails_CustomAttributesManager] sdm on sd.customAttributes = sdm.oid inner join [__Study Subject Type] sst on sst.oid = sdm.subjectType inner join [__Study Subject Type_CustomAttributesManager] sstc on sstc.oid = sst.customAttributes where a.status is not null and sstc.name = 'Animal' ) y \n",
          "on z._uid = y._uid and z.max_start_time = y.start_time\n",
          ") x\n",
          "group by _uid, start_time, oid, status\n", 
          "order by x.start_time;"
          ]
      }   
    ],
    "dlar": [
      {
        "name": "dcm:cagecard:status",
        "modelName": "_CageCard",
        "script": [
          "DECLARE @begin_time datetime, @end_time datetime, @from_lsn binary(10), @to_lsn binary(10);\n",
          "-- Obtain the beginning of the time interval.\n",
          "-- SET @begin_time = GETDATE() -1;\n",
          "SET @begin_time = dateadd(ss, 1, $(LAST_EXEC_TIME) );\n",
          "-- Obtain the end of the time interval.\n",
          "SET @end_time = GETDATE();\n",
          "-- Map the time interval to a change data capture query range.\n",
          "SET @from_lsn = sys.fn_cdc_map_time_to_lsn('smallest greater than or equal', @begin_time);\n",
          "SET @to_lsn = sys.fn_cdc_map_time_to_lsn('largest less than or equal', @end_time);\n",
          "-- Return the net changes occurring within the query window.\n",
          "select _uid, start_time, oid, status from (\n",
          "select y._uid, left(convert(varchar(24), y.start_time, 126), 19) start_time, y.oid, y.status from ( select max(sys.fn_cdc_map_lsn_to_time ( __$start_lsn )) max_start_time, b._webrunique_id _uid FROM cdc.fn_cdc_get_all_changes_dbo__Project(@from_lsn, @to_lsn, 'all') a inner join [__CageCard] b on a.oid = b.oid group by b._webrunique_id ) z \n",
          "inner join\n",
          "( select sys.fn_cdc_map_lsn_to_time ( __$start_lsn ) start_time, a.__$start_lsn, a.__$seqval, a.__$operation, a.__$update_mask, convert(varchar(max), a.oid, 2) oid, convert(varchar(max), a.status, 2) status, b._webrunique_id _uid FROM cdc.fn_cdc_get_all_changes_dbo__Project(@from_lsn, @to_lsn, 'all') a inner join [__CageCard] b on a.oid = b.oid where a.status is not null ) y \n",
          "on z._uid = y._uid and z.max_start_time = y.start_time\n",
          ") x\n",
          "group by _uid, start_time, oid, status\n", 
          "order by x.start_time;"
        ]
      }   
    ],
    "animalcensus": [
      {
        "name": "animalcensus:assets:status",
        "script": [          
          "DECLARE @begin_time datetime, @end_time datetime, @from_lsn binary(10), @to_lsn binary(10);\n",
          "-- Obtain the beginning of the time interval.\n",
          "-- SET @begin_time = GETDATE() -1;\n",
          "SET @begin_time = dateadd(ss, 1, $(LAST_EXEC_TIME) );\n",
          "--SET @begin_time = dateadd(ss, 1, '1970-01-01')\n", 
          "-- Obtain the end of the time interval.\n",
          "SET @end_time = GETDATE();\n",
          "-- Map the time interval to a change data capture query range.\n",
          "SET @from_lsn = sys.fn_cdc_map_time_to_lsn('smallest greater than or equal', @begin_time);\n",
          "SET @to_lsn = sys.fn_cdc_map_time_to_lsn('largest less than or equal', @end_time);\n",
          "-- Return the net changes occurring within the query window.\n",
          "select GRAI, BarCode, Zone, ProcessStatus, LastScanDateTime, CheckIn, CheckOut, start_time from (\n",
          "select y.GRAI, y.BarCode, y.Zone, y.ProcessStatus, case when y.LastScanDateTime is not null then convert(varchar(20), y.LastScanDateTime, 101) else '' end LastScanDateTime, case when y.CheckIn is not null then left(convert(varchar(24), y.CheckIn ,126), 19) else '' end CheckIn, case when y.CheckOut is not null then left(convert(varchar(24), y.CheckOut, 126), 19) else '' end CheckOut, left(convert(varchar(24), y.start_time, 126), 19) start_time from ( select a.grai, a.barcode, a.__$operation, max(sys.fn_cdc_map_lsn_to_time ( __$start_lsn )) max_start_time FROM cdc.fn_cdc_get_all_changes_dbo_Assets(@from_lsn, @to_lsn, 'all') a where a.__$operation = 4 group by a.grai, a.barcode, a.__$operation ) z \n",
          "inner join\n",
          "( select sys.fn_cdc_map_lsn_to_time ( __$start_lsn ) start_time, a.__$start_lsn, a.__$seqval, a.__$operation, a.__$update_mask, a.GRAI, a.Barcode BarCode, rt.Barcode Zone, a.ProcessStatus, a.ModifiedOn LastScanDateTime, a.CheckIn, a.CheckOut FROM cdc.fn_cdc_get_all_changes_dbo_Assets(@from_lsn, @to_lsn, 'all') a inner join AnimalCensus..Routing rt on a.location = rt.Id where a.processstatus is not null) y \n",
          "on z.grai = y.grai and z.barcode = y.barcode and z.__$operation = y.__$operation and z.max_start_time = y.start_time\n",
          ") x\n",
          "group by GRAI, BarCode, Zone, ProcessStatus, LastScanDateTime, CheckIn, CheckOut, start_time\n",
          "order by x.start_time;"
        ]
      }
    ]
  } 
}